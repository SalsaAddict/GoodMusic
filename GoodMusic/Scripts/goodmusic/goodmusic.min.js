var GoodMusic,gm;(function(n){"option strict";var t,i,r,u,f;n.debugEnabled=!0;n.fbAppId="1574477942882037";n.googleApiKey="AIzaSyCtuJp3jsaJp3X6U8ZS_X5H8omiAw5QaHg",function(n){var t=function(){function n(n,t,i){this.$q=n;this.$http=t;this.$log=i;i.debug("gm:database:init")}return n.prototype.execute=function(n,t){var u=this,r,i;t===void 0&&(t={});r={name:n,parameters:t};i=this.$q.defer();t.userId={value:this.userId||null};try{this.$http.post("execute.ashx",r).then(function(n){i.resolve(n.data);n.data.success||u.$log.error(n.data.data);u.$log.debug("gm:execute",r.name,{request:r,response:n.data.data})},function(n){i.resolve({success:!1,data:n.statusText});u.$log.error(n.status,n.statusText)})}catch(f){i.resolve({success:!1,data:f});this.$log.error(f.message)}return i.promise},n.$inject=["$q","$http","$log"],n}();n.Service=t}(t=n.Database||(n.Database={})),function(n){var t=function(){function n(n,t,i,r){var u=this;this.$rootScope=n;this.$route=t;this.$database=i;this.$log=r;this.login=this.$rootScope.$login=function(n){n.preventDefault();n.stopPropagation();var t=function(){delete u.$database.userId;u.$rootScope.$authenticated=!1;delete u.$rootScope.$username;u.$log.debug("gm:login:error")};try{FB.login(function(n){u.$log.debug("gm:fb:authResponse",n);n.status==="connected"?FB.api("/me",{fields:["id","first_name","last_name","gender"]},function(n){u.$database.userId=n.id;u.$database.execute("apiLogin",{forename:{value:n.first_name},surname:{value:n.last_name},gender:{value:n.gender}}).then(function(n){n.success?(u.$database.userId=n.data.id,u.$rootScope.$authenticated=!0,u.$rootScope.$username=n.data.name,u.$log.debug("gm:login",u.$database.userId),u.$route.reload()):t()})}):t()})}catch(i){t()}};this.logout=this.$rootScope.$logout=function(n){n.preventDefault();n.stopPropagation();try{FB.logout(angular.noop)}catch(t){u.$log.error("gm:logout:error",t.message)}finally{delete u.$database.userId;u.$rootScope.$authenticated=!1;delete u.$rootScope.$username;u.$log.debug("gm:logout");u.$route.reload()}};r.debug("gm:facebook:init")}return n.$inject=["$rootScope","$route","$database","$log"],n}();n.Service=t}(i=n.Facebook||(n.Facebook={})),function(n){var t=function(){function n(n,t){var i=this;this.$scope=n;this.$route=t;this.collapsed=!0;n.$on("$routeChangeSuccess",function(){i.collapsed=!0})}return Object.defineProperty(n.prototype,"title",{get:function(){var n="Good Music";if(!this.$route.current)return n;switch(this.$route.current.name){case"videos":return this.$scope.$playlist||"All Genres";default:return n}},enumerable:!0,configurable:!0}),n.prototype.toggle=function(){this.collapsed=!this.collapsed},n.$inject=["$scope","$route"],n}();n.Controller=t}(r=n.Menu||(n.Menu={})),function(n){var t=function(){function n(n,t,i,r){this.$rootScope=n;this.$routeParams=t;this.$database=i;this.$anchorScroll=r;this.page=1;this.pageSize=10;this.fetchVideos()}return Object.defineProperty(n.prototype,"period",{get:function(){return this.$routeParams.period||"week"},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"genreUri",{get:function(){return this.$routeParams.genreUri||null},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"styleUri",{get:function(){return this.$routeParams.styleUri||null},enumerable:!0,configurable:!0}),n.prototype.fetchVideos=function(){var n=this,t;this.$database.execute("apiVideos",{period:{value:this.period},genreUri:{value:this.genreUri},styleUri:{value:this.styleUri}}).then(function(t){n.$rootScope.$playlist=t.data.playlist;n.$rootScope.$videos=t.data.videos},angular.noop);t=1},n.$inject=["$rootScope","$routeParams","$database","$anchorScroll"],n}();n.Controller=t}(u=n.Videos||(n.Videos={})),function(n){var t=function(){function n(n,t){var i=this;this.$rootScope=n;this.$database=t;this.periods=[{id:"weekly",description:"Week"},{id:"monthly",description:"Month"},{id:"yearly",description:"Year"},{id:"all",description:"Ever"}];this.period=this.periods[0].id;this.fetchGenres().then(function(n){i.expand(n[0])})}return n.prototype.expand=function(n){this.genres.forEach(function(n){n.expanded=!1});n.expanded=!0},n.prototype.fetchGenres=function(){var n=this;return this.$database.execute("apiSearch").then(function(t){return n.genres=t.data.genres,n.genres[0].expanded=!0,n.genres},angular.noop)},n.$inject=["$rootScope","$database"],n}();n.Controller=t}(f=n.Search||(n.Search={}))})(GoodMusic||(GoodMusic={}));gm=angular.module("gm",["ngRoute","ngAria","ngAnimate","ui.bootstrap"]);gm.service("$database",GoodMusic.Database.Service);gm.service("$facebook",GoodMusic.Facebook.Service);gm.controller("menuController",GoodMusic.Menu.Controller);gm.config(["$logProvider","$routeProvider",function(n,t){n.debugEnabled(GoodMusic.debugEnabled);t.when("/home",{name:"home",templateUrl:"Views/home.html"}).when("/search",{name:"search",templateUrl:"Views/search.html",controller:GoodMusic.Search.Controller,controllerAs:"$ctrl"}).when("/videos/:period/:genreUri/:styleUri?",{name:"videos",templateUrl:"Views/videos.html",controller:GoodMusic.Videos.Controller,controllerAs:"$ctrl"}).otherwise({redirectTo:"/home"}).caseInsensitiveMatch=!0}]);gm.run(["$log","$window","$rootScope","$facebook",function(n,t,i){t.fbAsyncInit=function(){FB.init({appId:GoodMusic.fbAppId,version:"v2.8"});n.debug("gm:fbAsyncInit")};i.$authenticated=!1;n.debug("gm:run")}]);