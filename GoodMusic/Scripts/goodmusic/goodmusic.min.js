var GoodMusic,gm;(function(n){"option strict";var t,i,r,u,f,e,o;n.debugEnabled=!0;n.fbAppId="1574477942882037";n.googleApiKey="AIzaSyBqGRgdwJKpPGsToQ_1tOXvpeYmjNMW0Cw",function(n){var t=function(){function n(n,t,i){this.$q=n;this.$http=t;this.$log=i}return n.prototype.$execute=function(n,t){var u=this,r,i;t===void 0&&(t={});r={name:n,parameters:t};i=this.$q.defer();try{this.$http.post("execute.ashx",r).then(function(n){i.resolve(n.data);n.data.success||u.$log.error(n.data.data);u.$log.debug("gm:execute",r.name,{request:r,response:n.data.data})},function(n){i.resolve({success:!1,data:n.statusText});u.$log.error(n.status,n.statusText)})}catch(f){i.resolve({success:!1,data:f});this.$log.error(f.message)}return i.promise},n}();t.$inject=["$q","$http","$log"];n.Service=t}(t=n.Database||(n.Database={})),function(t){var i=function(){function t(t,i,r,u){var f=this;this.$database=t;this.$window=i;this.$route=r;this.$log=u;this.login=function(n){n&&(n.preventDefault(),n.stopPropagation());try{FB.login(angular.noop)}catch(t){f.deauthenticate(t.message)}};this.logout=function(n){n&&(n.preventDefault(),n.stopPropagation());try{FB.logout(angular.noop)}catch(t){f.deauthenticate(t)}};i.fbAsyncInit=function(){FB.init({appId:n.fbAppId,cookie:!0,status:!0,version:"v2.8"});FB.Event.subscribe("auth.authResponseChange",function(n){f.$log.debug("gm:fb:authResponse",n);try{n.status==="connected"?FB.api("/me",{fields:["id","first_name","last_name","gender"]},function(n){t.$execute("apiLogin",{userId:{value:n.id},forename:{value:n.first_name},surname:{value:n.last_name},gender:{value:n.gender}}).then(function(n){n.success?(f.user={id:n.data.id,name:n.data.name},f.$log.debug("gm:authenticate",f.user),f.$route.reload()):f.deauthenticate(n.data)})}):f.deauthenticate(n)}catch(i){f.deauthenticate(i)}});u.debug("gm:fb:init")};u.debug("gm:auth:init")}return Object.defineProperty(t.prototype,"authenticated",{get:function(){return this.user?!0:!1},enumerable:!0,configurable:!0}),t.prototype.deauthenticate=function(n){delete this.user;this.$log.debug("gm:deauthenticate",n);this.$route.reload()},t}();i.$inject=["$database","$window","$route","$log"];t.Service=i}(i=n.Authentication||(n.Authentication={})),function(n){var t=function(){function n(n,t,i,r,u){this.$authentication=n;this.$database=t;this.$filter=i;this.$window=r;this.$log=u;this.$data=angular.fromJson(this.$window.localStorage.getItem("$data")||"{}");this.pageSize=12}return Object.defineProperty(n.prototype,"loaded",{get:function(){return angular.isDefined(this.$data.videos)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"title",{get:function(){return this.$data.title||"Good Music"},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"parameters",{get:function(){return this.$data?this.$data.parameters||{}:{}},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"videos",{get:function(){return this.$data?angular.isArray(this.$data.videos)?this.$filter("orderBy")(this.$data.videos,function(n){return parseInt(n.rank,10)}):[]:[]},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"count",{get:function(){return this.videos.length},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"index",{get:function(){return this.count===0?-1:this.$data.index>=this.count?this.count-1:this.$data.index||0},set:function(n){this.$data.index=n},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"pageIndex",{get:function(){return this.index-(this.page-1)*this.pageSize},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"page",{get:function(){return this.index<=0?1:Math.floor(this.index/this.pageSize)+1},set:function(n){this.index=(n-1)*this.pageSize;this.$log.debug("gm:playlist:index",this.index,this.page)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"video",{get:function(){if(!(this.index<0))return this.videos[this.index]},enumerable:!0,configurable:!0}),n.prototype.load=function(n){var t=this;return this.$data={},this.$database.$execute("apiPlaylist",{period:{value:n.period||null},genreUri:{value:n.genreUri||null},styleUri:{value:n.styleUri||null},userId:{value:this.$authentication.user?this.$authentication.user.id||null:null}}).then(function(n){return n.success?(t.$data={parameters:n.data.parameters,title:n.data.title,videos:n.data.videos},t.$window.localStorage.setItem("$data",angular.toJson(t.$data))):t.$data={},t.index=t.count>0?0:-1,t.parameters},angular.noop)},n}();t.$inject=["$authentication","$database","$filter","$window","$log"];n.Service=t}(r=n.Playlist||(n.Playlist={})),function(n){var t=function(){function n(n,t,i,r){var u=this;this.$scope=n;this.$route=t;this.$authentication=i;this.$playlist=r;this.collapsed=!0;this.login=this.$authentication.login;this.logout=this.$authentication.logout;n.$on("$routeChangeSuccess",function(){u.collapsed=!0})}return Object.defineProperty(n.prototype,"title",{get:function(){var n="Good Music";if(!this.$route.current)return n;switch(this.$route.current.name){case"load":case"list":case"play":return this.$playlist.title;default:return n}},enumerable:!0,configurable:!0}),n.prototype.toggle=function(){this.collapsed=!this.collapsed},Object.defineProperty(n.prototype,"authenticated",{get:function(){return this.$authentication.authenticated},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"username",{get:function(){if(this.authenticated)return this.$authentication.user.name},enumerable:!0,configurable:!0}),n}();t.$inject=["$scope","$route","$authentication","$playlist"];n.Controller=t}(u=n.Menu||(n.Menu={})),function(n){var t=function(){function n(n,t,i){this.$database=n;this.$routeParams=t;this.$location=i;this.loadGenres()}return n.prototype.loadGenres=function(){var n=this;this.$database.$execute("apiSearch").then(function(t){n.genres=t.data.genres;n.expand(n.$routeParams.genreUri||n.genres[0].uri)||n.$location.path("/search")},angular.noop)},n.prototype.expand=function(n,t){t&&(t.preventDefault(),t.stopPropagation());var i=!1;return this.genres.forEach(function(t){t.expanded=t.uri===n?i=!0:!1}),i},n}();t.$inject=["$database","$routeParams","$location"];n.Controller=t}(f=n.Search||(n.Search={})),function(n){var t=function(){function n(n,t,i,r,u,f){this.$location=n;this.$route=t;this.$routeParams=i;this.$playlist=r;this.$anchorScroll=u;this.$log=f;this.periods=["all","weekly","monthly","yearly"];switch(this.action){case"load":this.load(this.$routeParams);this.$route.updateParams(this.$playlist.parameters);break;case"list":r.loaded||(f.warn("gm:playlist:nolist"),n.path("/search"))}this.index>0&&n.hash(String(this.index+1));u.yOffset=70;u()}return n.prototype.load=function(n){var t=this;this.$playlist.load(n).then(function(i){angular.equals(n,i)||t.$route.updateParams(i)},angular.noop)},Object.defineProperty(n.prototype,"loaded",{get:function(){return this.$playlist.loaded},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"action",{get:function(){return this.$route.current.name},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"title",{get:function(){return this.$playlist.title},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"videos",{get:function(){return this.$playlist.videos},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"count",{get:function(){return this.$playlist.count},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"index",{get:function(){return this.$playlist.index},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"pageIndex",{get:function(){return this.$playlist.pageIndex},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"pageSize",{get:function(){return this.$playlist.pageSize},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"page",{get:function(){return this.$playlist.page},set:function(n){this.$playlist.page=n},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"period",{get:function(){return this.$playlist.parameters.period||"all"},enumerable:!0,configurable:!0}),n.prototype.setPeriod=function(n){var t="/videos/"+n+"/"+this.$playlist.parameters.genreUri;this.$playlist.parameters.styleUri&&(t+="/"+this.$playlist.parameters.styleUri);this.$location.path(t)},n.prototype.open=function(n,t){t&&(t.preventDefault(),t.stopPropagation());this.$playlist.index=parseInt(n.rank)-1;this.$location.hash("");this.$location.path("/video")},n}();t.$inject=["$location","$route","$routeParams","$playlist","$anchorScroll","$log"];n.Controller=t}(e=n.Videos||(n.Videos={})),function(n){var t=function(){function n(n,t,i,r){var u=this;if(this.$scope=n,this.$playlist=t,this.$location=i,this.$log=r,!t.video){r.warn("gm:video:novideo");i.path("/search");return}this.player=new YT.Player("player",{width:"100%",height:"100%",events:{onReady:function(){u.play();u.$scope.$apply()},onStateChange:function(n){n.data===YT.PlayerState.ENDED&&(u.next(),u.$scope.$apply())}}})}return Object.defineProperty(n.prototype,"video",{get:function(){return this.$playlist.video},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"$first",{get:function(){return this.$playlist.index===0},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"$last",{get:function(){return this.$playlist.index===this.$playlist.count-1},enumerable:!0,configurable:!0}),n.prototype.play=function(){this.$location.hash(String(this.$playlist.index+1));this.player.getPlayerState()===YT.PlayerState.PLAYING&&this.player.stopVideo();this.player.loadVideoById(this.video.videoId)},n.prototype.previous=function(n){n&&(n.preventDefault(),n.stopPropagation());this.$playlist.index--;this.play()},n.prototype.next=function(n){n&&(n.preventDefault(),n.stopPropagation());this.$playlist.index++;this.play()},n}();t.$inject=["$scope","$playlist","$location","$log"];n.Controller=t}(o=n.Video||(n.Video={}))})(GoodMusic||(GoodMusic={}));gm=angular.module("gm",["ngRoute","ngAria","ngAnimate","ui.bootstrap"]);gm.service("$database",GoodMusic.Database.Service);gm.service("$authentication",GoodMusic.Authentication.Service);gm.service("$playlist",GoodMusic.Playlist.Service);gm.controller("menuController",GoodMusic.Menu.Controller);gm.config(["$logProvider","$routeProvider",function(n,t){n.debugEnabled(GoodMusic.debugEnabled);t.when("/home",{name:"home",templateUrl:"Views/home.html"}).when("/search/:genreUri?",{name:"search",templateUrl:"Views/search.html",controller:GoodMusic.Search.Controller,controllerAs:"$ctrl",reloadOnSearch:!1}).when("/videos/:period/:genreUri/:styleUri?",{name:"load",templateUrl:"Views/videos.html",controller:GoodMusic.Videos.Controller,controllerAs:"$ctrl",reloadOnSearch:!1}).when("/videos",{name:"list",templateUrl:"Views/videos.html",controller:GoodMusic.Videos.Controller,controllerAs:"$ctrl",reloadOnSearch:!1}).when("/video",{name:"play",templateUrl:"Views/video.html",controller:GoodMusic.Video.Controller,controllerAs:"$ctrl",reloadOnSearch:!1}).otherwise({redirectTo:"/home"}).caseInsensitiveMatch=!0}]);gm.run(["$authentication","$log",function(n,t){t.debug("gm:run")}]);